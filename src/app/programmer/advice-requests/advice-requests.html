<div class="container fade-in">
  <h1>üì¨ Solicitudes de Asesor√≠a</h1>
  <p class="subtitle">Gestiona las peticiones de tus clientes.</p>

  <section class="section-block">
    <h2>‚è≥ Pendientes de Aprobaci√≥n</h2>
    
    <div class="advisory-list">
      @for (item of pending$ | async; track item.id) {
        <div class="card pending">
          <div class="card-header">
            <strong>{{ item.clientName }}</strong>
            <span class="date">{{ item.dateRequest | date:'medium' }}</span>
          </div>
          
          <div class="card-body">
            <p class="topic"><strong>Motivo:</strong> {{ item.topic }}</p>
            <p class="contact">üìß {{ item.clientEmail }}</p>
          </div>

          <div class="card-actions">
            <button (click)="openResponse(item)" class="btn-respond">
              Responder
            </button>
          </div>
        </div>
      } @empty {
        <div class="empty-state">
          <p>üéâ No tienes solicitudes pendientes.</p>
        </div>
      }
    </div>
  </section>

  <section class="section-block mt-4">
    <h2>üóÇÔ∏è Historial</h2>
    
    <div class="history-table-container">
      <table class="history-table">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Tu Respuesta</th>
          </tr>
        </thead>
        <tbody>
          @for (item of history$ | async; track item.id) {
            <tr>
              <td>{{ item.clientName }}</td>
              <td>{{ item.dateRequest | date:'shortDate' }}</td>
              <td>
                <span class="badge" [class]="item.status">
                  {{ item.status === 'accepted' ? 'Aprobada' : 'Rechazada' }}
                </span>
              </td>
              <td class="comment">{{ item.adminComment }}</td>
            </tr>
          } @empty {
            <tr><td colspan="4" class="text-center">Sin historial.</td></tr>
          }
        </tbody>
      </table>
    </div>
  </section>

  @if (selectedAdvisory) {
    <div class="modal-overlay">
      <div class="modal-content slide-up">
        <h3>Responder a {{ selectedAdvisory.clientName }}</h3>
        
        <div class="request-summary">
          <p><strong>Solicita para:</strong> {{ selectedAdvisory.dateRequest | date:'medium' }}</p>
          <p><strong>Motivo:</strong> "{{ selectedAdvisory.topic }}"</p>
        </div>

        <div class="form-group">
          <label>Mensaje de respuesta (Requerido):</label>
          <textarea [(ngModel)]="responseMessage" 
                    rows="3" 
                    placeholder="Ej: Claro, nos vemos ese d√≠a... o Lo siento, no tengo disponibilidad..."></textarea>
        </div>

        <div class="modal-actions">
          <button (click)="submitResponse('accepted')" class="btn-accept">‚úÖ Aprobar</button>
          <button (click)="submitResponse('rejected')" class="btn-reject">‚ùå Rechazar</button>
          <button (click)="selectedAdvisory = null" class="btn-cancel">Cancelar</button>
        </div>
      </div>
    </div>
  }
</div>